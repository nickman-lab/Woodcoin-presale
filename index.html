
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WOODCOIN Pre-Sale</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body {
      background: #000;
      color: #f1c40f;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px 20px;
    }
    button {
      margin-top: 20px;
      padding: 15px 25px;
      background: #2980b9;
      color: #fff;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .wallet-status, .warning, .timer, .message {
      margin-top: 20px;
      font-size: 16px;
    }
    .progress-container {
      margin-top: 30px;
      width: 80%;
      background-color: #333;
      border-radius: 10px;
      margin-left: auto;
      margin-right: auto;
      height: 25px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background-color: #27ae60;
      width: 0%;
      transition: width 0.5s ease-in-out;
    }
    .note {
      font-size: 14px;
      margin-top: 5px;
      color: #ccc;
    }
    a {
      color: #ccc;
    }
  </style>

<script>
async function connectWallet() {
    if (typeof window.ethereum !== 'undefined') {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            document.getElementById("walletStatus").innerText = "Wallet: " + accounts[0];
        } catch (error) {
            alert("Connection failed: " + error.message);
        }
    } else {
        // Redirect to wallet download page (e.g. MetaMask or BestWallet)
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        if (/android/i.test(userAgent)) {
            window.location.href = "https://play.google.com/store/apps/details?id=io.metamask";
        } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            window.location.href = "https://apps.apple.com/app/metamask/id1438144202";
        } else {
            window.location.href = "https://metamask.io/download/";
        }
    }
}
</script>

</head>
\1

  <!-- Wallet Status Badge -->
  <div id="wallet-status" style="position: fixed; top: 10px; right: 10px; background-color: #222; color: #0f0; padding: 6px 12px; border-radius: 10px; font-weight: 700; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; display: none; z-index: 9999; box-shadow: 0 2px 10px rgba(0,0,0,0.3); letter-spacing: 0.2px;">
    W ‚úî Connected
  </div>

  <!-- Add BNB Smart Chain Button -->
  <button id="add-bsc-btn" style="position: fixed; top: 54px; right: 10px; background-color: #f0b90b; color: #111; padding: 8px 12px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; display: inline-block; z-index: 9999; box-shadow: 0 2px 10px rgba(0,0,0,0.25);">
    + Add BNB Smart Chain
  </button>


  <h1>üî• WOODCOIN Pre-Sale</h1>
  <p style="margin-top: 10px; color: #ffd700; font-size: 16px;">
    WOODCOIN is a Play-to-Earn token that fuels the WOOD ecosystem.<br>
    Earn it. Use it. Burn it. üî•
  </p>

  <h2>Buy now: 50,000 WOOD per 1 BNB</h2>

  
    <div class="timer" id="countdown">‚è≥ Loading timer...</div>
    
        
<div id="woodInfo" style="margin-top: 5px; font-size: 14px; color: #ccc;">
  ü™ô WOOD Distributed: -- WOOD<br>
  üíµ 1 WOOD = $0.005
</div>

    <div id="bnbValue" style="margin-top: 5px; font-size: 14px; color: #ccc;">‚âà -- USD raised</div>
        <div id="bnbPrice"
         style="margin-top: 10px; font-size: 15px; color: #fff;">BNB Price: $--</div>
    <script>
      async function getBNBPrice() {
        try {
          const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd");
          const data = await res.json();
          const price = data.binancecoin.usd;
          
        
document.getElementById("bnbPrice").innerText = "BNB Price: $" + price.toFixed(2);

try {
  const raisedText = document.getElementById("bnbRaisedText")?.innerText;
  const match = raisedText?.match(/\d+(\.\d+)?/);
  if (match && match[0]) {
    const raisedBNB = parseFloat(match[0]);
    const usdValue = (raisedBNB * price).toFixed(2);
    document.getElementById("bnbValue").innerText = "‚âà $" + usdValue + " raised";
  } else {
    
try {
  const raisedText = document.getElementById("bnbRaisedText")?.innerText;
  const match = raisedText?.match(/\d+(\.\d+)?/);
  if (match && match[0]) {
    const raisedBNB = parseFloat(match[0]);
    const usdValue = (raisedBNB * price).toFixed(2);
    document.getElementById("bnbValue").innerText = "‚âà $" + usdValue + " raised";

    // Calcul WOOD distribuit (1 WOOD = 0.005 USD)
    const woodAmount = Math.floor(usdValue / 0.005);
    document.getElementById("woodInfo").innerHTML = `
      ü™ô WOOD Distributed: ${woodAmount.toLocaleString()} WOOD<br>
      üíµ 1 WOOD = $0.005
    `;
  } else {
    document.getElementById("bnbValue").innerText = "‚âà $-- raised";
  }
} catch (e) {
  document.getElementById("bnbValue").innerText = "‚âà $-- raised";
}

  }
} catch (e) {
  
try {
  const raisedText = document.getElementById("bnbRaisedText")?.innerText;
  const match = raisedText?.match(/\d+(\.\d+)?/);
  if (match && match[0]) {
    const raisedBNB = parseFloat(match[0]);
    const usdValue = (raisedBNB * price).toFixed(2);
    document.getElementById("bnbValue").innerText = "‚âà $" + usdValue + " raised";

    // Calcul WOOD distribuit (1 WOOD = 0.005 USD)
    const woodAmount = Math.floor(usdValue / 0.005);
    document.getElementById("woodInfo").innerHTML = `
      ü™ô WOOD Distributed: ${woodAmount.toLocaleString()} WOOD<br>
      üíµ 1 WOOD = $0.005
    `;
  } else {
    document.getElementById("bnbValue").innerText = "‚âà $-- raised";
  }
} catch (e) {
  document.getElementById("bnbValue").innerText = "‚âà $-- raised";
}

}

        try {
          const raisedText = document.getElementById("bnbRaisedText").innerText;
          const raisedBNB = parseFloat(raisedText.split(":")[1]);
          const usdValue = (raisedBNB * price).toFixed(2);
          document.getElementById("bnbValue").innerText = "‚âà $" + usdValue + " raised";
        } catch (e) {
          
try {
  const raisedText = document.getElementById("bnbRaisedText")?.innerText;
  const match = raisedText?.match(/\d+(\.\d+)?/);
  if (match && match[0]) {
    const raisedBNB = parseFloat(match[0]);
    const usdValue = (raisedBNB * price).toFixed(2);
    document.getElementById("bnbValue").innerText = "‚âà $" + usdValue + " raised";

    // Calcul WOOD distribuit (1 WOOD = 0.005 USD)
    const woodAmount = Math.floor(usdValue / 0.005);
    document.getElementById("woodInfo").innerHTML = `
      ü™ô WOOD Distributed: ${woodAmount.toLocaleString()} WOOD<br>
      üíµ 1 WOOD = $0.005
    `;
  } else {
    document.getElementById("bnbValue").innerText = "‚âà $-- raised";
  }
} catch (e) {
  document.getElementById("bnbValue").innerText = "‚âà $-- raised";
}

        }
        
        } catch (err) {
          console.error("CoinGecko API error:", err);
        }
      }
      getBNBPrice();
      setInterval(getBNBPrice, 30000); // actualizeazƒÉ la 30 secunde
    </script>
    

  <div class="wallet-status" id="walletAddress"><span id="wallet-address" style="color:yellow;">Wallet: Not connected</span><br><span id="wallet-address" style="color:#00ff00;"></span></div>
  <button onclick="connectWallet()">Connect Wallet</button>
<div style="margin-top: 10px;">
  <a href="https://metamask.io/download/" target="_blank">
    <button style="background: orange; color: black; font-weight: bold;">üîΩ Download MetaMask</button>
  </a>
</div>

  <br/>
  <button onclick="addToken()">Add WOODCOIN to Wallet</button>
  <button onclick="buyWoodcoin()" disabled style="background:#555;color:#999;cursor:not-allowed;">Buy Now</button>
<br>
<input type="number" id="bnbAmount" placeholder="Enter BNB amount" 
style="margin-top: 10px; padding: 10px; font-size: 16px; border-radius: 8px; width: 80%; max-width: 300px;">


  <div class="message" id="statusMsg"></div>
  <div class="warning" id="warningMsg" style="color:red;"></div>

  <div id="progressSection">
    <p id="bnbRaisedText">üí∞ Raised: -- / 100 BNB</p>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="note">Live balance from BSC Mainnet</div>
    <p class="note">
      Sale Contract:
      <a href="https://bscscan.com/address/0x7cebc99b114138152D54589BaF6a386b5435f4d0" target="_blank">0x7ceb...f4d0</a>
    </p>
  </div>

  <section style="margin-top: 40px;">
    <h3 style="color: #f39c12; font-size: 20px;">üéÆ WOODCOIN Games</h3>
    <p style="font-size: 14px; line-height: 1.6; color: #fff;">
    <b>WOODCOIN21</b> ‚Äì A fast-paced blackjack-style game. Play for free or with real WOOD in multiplayer mode. Private rooms, strategy, and üî• rewards.<br><br>
    <b>Don't Get Mad, WOOD!</b> ‚Äì A web3 remake of the classic board game. Move your pawns, race to win, and collect WOOD with every game. üé≤
    </p>
  </section>

  <section style="margin-top: 40px;">
    <h3 style="color: #00ffff; font-size: 20px;">üìÖ WOODCOIN Roadmap</h3>
    <ul style="font-size: 14px; text-align: left; max-width: 600px; margin: 0 auto; color: #fff;">
      <li>‚úÖ Presale V1‚ÄìV2 (Testnet)</li>
      <li>‚úÖ Presale V3 (50,000 WOOD / BNB)</li>
      <li>üîú WOODCOIN21 ‚Äì Web3 blackjack game</li>
      <li>üîú Don‚Äôt Get Mad, WOOD! ‚Äì Multiplayer board game</li>
      <li>üîí WOOD listing on DEX (PancakeSwap or similar)</li>
      <li>üîí NFTs, tournaments, and ecosystem expansion</li>
    </ul>
  </section>

  <script>
    const saleAddress = "0x7cebc99b114138152D54589BaF6a386b5435f4d0";

    if (typeof window.web3 === 'undefined') {
      window.web3 = new Web3('https://bsc-dataseed.binance.org/');
    }

    async function connectWallet() {
      if (typeof window.ethereum === 'undefined') {
        document.getElementById('warningMsg').innerText = '‚ùå Wallet not detected.';
        return;
      }

      window.web3 = new Web3(window.ethereum);

      try {
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [{
            chainId: '0x38',
            chainName: 'Binance Smart Chain',
            rpcUrls: ['https://bsc-dataseed.binance.org/'],
            nativeCurrency: {
              name: 'BNB',
              symbol: 'BNB',
              decimals: 18
            },
            blockExplorerUrls: ['https://bscscan.com']
          }]
        });

        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        userWallet = accounts[0];
        document.getElementById('walletAddress').innerText = 'Wallet: ' + userWallet;
        updateProgress();
      } catch (err) {
        document.getElementById('statusMsg').innerText = '‚ùå Wallet connection failed.';
      }
    }

    async function addToken() {
      try {
        const wasAdded = await window.ethereum.request({
          method: 'wallet_watchAsset',
          params: {
            type: 'ERC20',
            options: {
              address: '0x5c96991B2EB50924348eCcf3bBB97cDc0a83466E',
              symbol: 'WOOD',
              decimals: 18,
            },
          },
        });

        if (wasAdded) {
          console.log('WOODCOIN added to wallet!');
        }
      } catch (error) {
        console.error('Add token error:', error);
      }
    }

    async function buyWoodcoin() {
      if (!userWallet) {
        alert("Please connect your wallet first.");
        return;
      }

      const txn = {
        from: userWallet,
        to: saleAddress
        // User will input amount in MetaMask
      };

      try {
        const txHash = await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [txn],
        });

        
    document.getElementById('statusMsg').innerHTML = `
      <div style='font-size:18px; color:#00ff99;'>
        ‚úÖ Transaction sent!<br>
        üéâ You will receive your WOOD soon.<br>
        <span style='font-size:13px;'>TX Hash: ${txHash}</span>
      </div>
    `;
    
        updateProgress();
      } catch (err) {
        document.getElementById('statusMsg').innerText = '‚ùå Transaction failed or cancelled.';
      }
    }

    async function updateProgress() {
      try {
        const balanceWei = await window.web3.eth.getBalance(saleAddress);
        const balanceBNB = window.web3.utils.fromWei(balanceWei, 'ether');
        const raised = parseFloat(balanceBNB);
        const percent = Math.min((raised / 100) * 100, 100);
        document.getElementById('bnbRaisedText').innerText = `üí∞ Raised: ${raised.toFixed(3)} / 100 BNB`;
        document.getElementById('progressBar').style.width = percent + "%";
      } catch (err) {
        console.error("Error fetching balance:", err);
      }
    }

    
let endTime;
const storedTime = localStorage.getItem("woodcoinCountdown");

if (storedTime && parseInt(storedTime) > Date.now()) {
  endTime = parseInt(storedTime);
} else {
  endTime = Date.now() + (14 * 24 * 60 * 60 * 1000);
  localStorage.setItem("woodcoinCountdown", endTime.toString());
}

    const timerEl = document.getElementById('countdown');
    setInterval(() => {
      const now = new Date().getTime();
      const diff = endTime - now;
      if (diff <= 0) {
        timerEl.innerText = "‚õî Tier 1 has ended. Tier 2 coming soon!";
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      timerEl.innerText = `‚è≥ ${days}d ${hours}h ${minutes}m ${seconds}s left until price increase (+7%)`;
    }, 1000);

    window.addEventListener("load", updateProgress);
  </script>

  <div style="margin-top:60px; font-size:13px; color:gray;">
    <a href="#" onclick="document.getElementById('termsModal').style.display='flex'; return false;" style="color:#ccc;">Terms & Conditions</a>
  </div>

  <div id="termsModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.95); color:white; display:flex; align-items:center; justify-content:center; z-index:9999;">
    <div style="max-width:90%; background:#111; padding:20px 25px; border-radius:10px; text-align:left;">
      <h2 style="text-align:center;">Terms & Conditions</h2>
      <p style="font-size:14px; line-height:1.6;">
        WOODCOIN is a utility token used within the WOOD ecosystem.<br><br>
        It does not represent ownership, investment, or any form of profit guarantee.<br><br>
        By participating in this pre-sale, you accept the risks of interacting with Web3 tokens, and understand that all transactions are final.<br><br>
        Always do your own research (DYOR) and never invest more than you can afford to lose. üî•
      </p>
      <div style="text-align:center;">
        <button onclick="document.getElementById('termsModal').style.display='none';" style="margin-top:20px; padding:10px 20px; font-size:16px;">Close</button>
      </div>
    </div>
  </div>


<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script>
const SALE_ADDRESS = "0x7cebc99b114138152D54589BaF6a386b5435f4d0";
const TOKEN_ADDRESS = "0x5c96991B2EB50924348eCcf3bBB97cDc0a83466E";
const ABI = [{
  "inputs": [{"internalType":"address","name":"beneficiary","type":"address"}],
  "name":"buyTokens",
  "outputs":[],
  "stateMutability":"payable",
  "type":"function"
}];

let userAddress = null;

async function connectWallet() {
  if (!window.ethereum) {
    alert("MetaMask not detected!");
    return;
  }

  const chainId = await ethereum.request({ method: 'eth_chainId' });
  if (chainId !== '0x38') {
    try {
      await ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: '0x38' }]
      });
    } catch (switchErr) {
      await ethereum.request({
        method: 'wallet_addEthereumChain',
        params: [{
          chainId: '0x38',
          chainName: 'Binance Smart Chain',
          rpcUrls: ['https://bsc-dataseed.binance.org/'],
          nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
          blockExplorerUrls: ['https://bscscan.com']
        }]
      });
    }
  }

  const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
  userAddress = accounts[0];
  document.getElementById('walletAddress').innerText = 'Wallet: ' + userAddress;
}

async function addToken() {
  if (!window.ethereum) return;
  try {
    await ethereum.request({
      method: 'wallet_watchAsset',
      params: {
        type: 'ERC20',
        options: {
          address: TOKEN_ADDRESS,
          symbol: 'WOOD',
          decimals: 18,
        },
      },
    });
  } catch (err) {
    console.error('Add token error:', err);
  }
}

async function buyTokens() {
  if (!userAddress) {
    alert("Connect your wallet first!");
    return;
  }

  const amount = prompt("Enter amount of BNB to spend:");
  if (!amount || isNaN(amount)) return;

  const web3 = new Web3(window.ethereum);
  const contract = new web3.eth.Contract(ABI, SALE_ADDRESS);
  const value = web3.utils.toWei(amount, 'ether');

  contract.methods.buyTokens(userAddress).send({
    from: userAddress,
    value
  })
  .on("transactionHash", function(hash){
    alert("Transaction sent: " + hash);
  })
  .on("receipt", function(receipt){
    alert("‚úÖ Transaction confirmed!");
  })
  .on("error", function(err){
    alert("‚ùå Transaction failed");
  });
}
</script>


<script>
  async function connectWallet() {
    if (typeof window.ethereum !== "undefined") {
      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        document.getElementById("wallet-status").textContent = "‚úÖ Wallet connected";
      } catch (error) {
        alert("Wallet connection failed.");
      }
    } else {
      alert("MetaMask not detected! Please open this page in MetaMask, Trust Wallet, BestWallet or TokenPocket.");
      window.location.href = "https://metamask.app.link/dapp/woodcoin-presale.vercel.app";
    }
  }

  async function addToken() {
    if (typeof window.ethereum !== "undefined") {
      try {
        await window.ethereum.request({
          method: "wallet_watchAsset",
          params: {
            type: "ERC20",
            options: {
              address: "0x5c96991B2EB50924348eCcf3bBB97cDc0a83466E",
              symbol: "WOOD",
              decimals: 18,
              image: "https://woodcoin.vercel.app/wood-logo.png"
            },
          },
        });
      } catch (error) {
        alert("Could not add token.");
      }
    } else {
      alert("Please use MetaMask or supported Web3 wallet.");
    }
  }

  window.onload = function () {
    const connectBtn = document.getElementById("connect-wallet");
    const addBtn = document.getElementById("add-woodcoin");

    if (connectBtn) connectBtn.onclick = connectWallet;
    if (addBtn) addBtn.onclick = addToken;
  };
</script>




<script>
async function updateWalletStatus() {
  if (typeof window.ethereum !== 'undefined') {
    try {
      const accounts = await window.ethereum.request({ method: 'eth_accounts' });
      if (accounts.length > 0) {
        const walletAddress = accounts[0];
        document.getElementById("wallet-address").innerText = "Wallet: " + walletAddress;
      }
    } catch (err) {
      console.error("Error fetching wallet:", err);
    }
  }
}

window.addEventListener('load', updateWalletStatus);
</script>


  <script>
  (function(){
    function shorten(addr){
      if(!addr || typeof addr !== 'string') return '';
      return addr.slice(0,6) + '...' + addr.slice(-4);
    }
    function showBadge(address){
      var el = document.getElementById('wallet-status');
      if(!el) return;
      if(address){
        el.textContent = 'W ‚úî Connected ‚Äî ' + shorten(address);
        el.style.display = 'inline-block';
      } else {
        el.style.display = 'none';
      }
    }
    async function checkAccounts(){
      try{
        if(window.ethereum && window.ethereum.request){
          var accs = await window.ethereum.request({ method: 'eth_accounts' });
          if(accs && accs.length > 0){
            showBadge(accs[0]);
          } else {
            showBadge(null);
          }
        }
      }catch(e){
        console.warn('Wallet check failed:', e);
      }
    }

    // Listen for account changes
    if(window.ethereum){
      try{
        window.ethereum.on && window.ethereum.on('accountsChanged', function(accs){
          if(accs && accs.length > 0){ showBadge(accs[0]); } else { showBadge(null); }
        });
      }catch(e){}
    }

    // Intercept eth_requestAccounts to update badge right after connect
    if(window.ethereum && window.ethereum.request){
      try{
        var _origReq = window.ethereum.request.bind(window.ethereum);
        window.ethereum.request = async function(args){
          var res = await _origReq(args);
          try{
            if(args && args.method === 'eth_requestAccounts'){
              var accs = Array.isArray(res) ? res : (await _origReq({method:'eth_accounts'}));
              if(accs && accs.length > 0){ showBadge(accs[0]); }
            }
          }catch(e){}
          return res;
        }
      }catch(e){}
    }

    document.addEventListener('DOMContentLoaded', checkAccounts);
    // Also re-check on visibility change (returns to tab)
    document.addEventListener('visibilitychange', function(){ if(!document.hidden) checkAccounts(); });
    // Periodic gentle check (fails silently)
    setInterval(checkAccounts, 15000);
  })();
  </script>

  <script>
    (function(){
      async function addBsc(){
        if(!(window.ethereum && window.ethereum.request)){
          alert('No wallet detected. Please install MetaMask or a compatible wallet.');
          return;
        }
        try{
          // Add BNB Smart Chain (Mainnet)
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: '0x38', // 56
              chainName: 'BNB Smart Chain',
              nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
              rpcUrls: ['https://bsc-dataseed.binance.org/'],
              blockExplorerUrls: ['https://bscscan.com']
            }]
          });
          // Switch to it (in case wallet needs explicit switch)
          try{
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x38' }]
            });
          }catch(eSwitch){
            // ignore if user rejected or already on chain
            console.warn('switch error', eSwitch);
          }
          // Optional small confirmation
          var btn = document.getElementById('add-bsc-btn');
          if(btn){ btn.textContent = 'BNB Chain Added ‚úì'; btn.disabled = true; btn.style.opacity = '0.8'; }
        }catch(e){
          console.warn('Add BSC failed:', e);
          alert('Could not add BNB Smart Chain: ' + (e && e.message ? e.message : e));
        }
      }
      document.addEventListener('DOMContentLoaded', function(){
        var btn = document.getElementById('add-bsc-btn');
        if(btn){ btn.addEventListener('click', addBsc); }
      });
    })();
  </script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("bnb-amount");
  const btn = document.getElementById("buy-btn");

  if(input && btn){
    input.addEventListener("input", function() {
      const val = parseFloat(input.value);
      if(!isNaN(val) && val > 0){
        btn.disabled = false;
        btn.style.background = "#f0b90b";   // BNB yellow
        btn.style.color = "#111";
        btn.style.cursor = "pointer";
      } else {
        btn.disabled = true;
        btn.style.background = "#555";
        btn.style.color = "#999";
        btn.style.cursor = "not-allowed";
      }
    });
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("buy-btn");
  const input = document.getElementById("bnb-amount");
  const SALE_ADDRESS = "0x7cebc99b114138152D54589BaF6a386b5435f4d0";

  if(btn && input){
    btn.addEventListener("click", async function() {
      const val = parseFloat(input.value);

      if(!window.ethereum){
        alert("Please install MetaMask or a compatible wallet.");
        return;
      }

      try {
        const accounts = await ethereum.request({ method: 'eth_accounts' });
        if(!accounts || accounts.length === 0){
          alert("Please connect your wallet first.");
          return;
        }

        if(isNaN(val) || val <= 0){
          alert("Enter a valid BNB amount.");
          return;
        }

        const tx = {
          from: accounts[0],
          to: SALE_ADDRESS,
          value: "0x" + (BigInt(Math.floor(val * 1e18)).toString(16))
        };

        const txHash = await ethereum.request({
          method: 'eth_sendTransaction',
          params: [tx]
        });

        alert("Transaction sent! TX Hash: " + txHash);
      } catch (err) {
        console.error(err);
        alert("Transaction failed: " + (err.message || err));
      }
    });
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("buy-btn");
  const input = document.getElementById("bnb-amount");
  const SALE_ADDRESS = "0x7cebc99b114138152D54589BaF6a386b5435f4d0";

  function toHexWei(bnb){
    try { return "0x" + (BigInt(Math.floor(Number(bnb) * 1e18)).toString(16)); }
    catch(e){ return null; }
  }

  if(btn && input){
    btn.addEventListener("click", async function() {
      const val = parseFloat(input.value);

      if(!window.ethereum){
        alert("Please install MetaMask or a compatible wallet.");
        return;
      }

      try {
        // Check connection
        let accounts = await ethereum.request({ method: 'eth_accounts' });
        if(!accounts || accounts.length === 0){
          // Prompt connect, then re-check
          accounts = await ethereum.request({ method: 'eth_requestAccounts' }).catch(() => []);
          if(!accounts || accounts.length === 0){
            alert("Please connect your wallet first.");
            return;
          }
        }

        // Validate amount
        if(isNaN(val) || val <= 0){
          alert("Enter a valid BNB amount.");
          return;
        }

        // Optionally warn if not on BSC (chainId 0x38)
        try{
          const chainId = await ethereum.request({ method: 'eth_chainId' });
          if(chainId !== '0x38'){
            const go = confirm("You are not on BNB Smart Chain. Switch now?");
            if(go){
              try{
                await ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });
              }catch(eSwitch){ /* user might reject; continue or abort */ }
            }
          }
        }catch(e){ /* ignore */ }

        const weiHex = toHexWei(val);
        if(!weiHex){
          alert("Invalid amount.");
          return;
        }

        const tx = {
          from: accounts[0],
          to: SALE_ADDRESS,
          value: weiHex
        };

        const txHash = await ethereum.request({ method: 'eth_sendTransaction', params: [tx] });
        alert("Transaction sent! TX Hash: " + txHash);
      } catch (err) {
        console.error(err);
        alert("Transaction failed: " + (err && err.message ? err.message : err));
      }
    });
  }
});
</script>

<script>
// === WOODCOIN BUY: wiring for existing markup ===
(function(){
  function styleDisabled(btn, disabled){
    if(!btn) return;
    btn.disabled = !!disabled;
    if(disabled){
      btn.style.background = "#555";
      btn.style.color = "#999";
      btn.style.cursor = "not-allowed";
    } else {
      btn.style.background = "#f0b90b";
      btn.style.color = "#111";
      btn.style.cursor = "pointer";
    }
  }

  async function ensureConnected(){
    if(!(window.ethereum && window.ethereum.request)) return null;
    let accs = await ethereum.request({ method: 'eth_accounts' });
    if(!accs || accs.length === 0){
      try{ accs = await ethereum.request({ method: 'eth_requestAccounts' }); }
      catch(e){ return null; }
    }
    return (accs && accs[0]) ? accs[0] : null;
  }

  function toHexWei(bnb){
    try { return "0x" + (BigInt(Math.floor(Number(bnb) * 1e18)).toString(16)); }
    catch(e){ return null; }
  }

  // Patch the global buyWoodcoin used by the existing button
  window.buyWoodcoin = async function(){
    const input = document.getElementById("bnbAmount");
    const amount = input ? parseFloat(input.value) : NaN;

    if(!window.ethereum){
      alert("Please install MetaMask or a compatible wallet.");
      return;
    }
    const from = await ensureConnected();
    if(!from){
      alert("Please connect your wallet first.");
      return;
    }
    if(isNaN(amount) || amount <= 0){
      alert("Enter a valid BNB amount.");
      return;
    }
    try{
      // Optional: switch to BSC
      try{
        const chainId = await ethereum.request({ method: 'eth_chainId' });
        if(chainId !== '0x38'){
          await ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });
        }
      }catch(e){ /* user may reject; continue on their current chain */ }

      const SALE_ADDRESS = "0x7cebc99b114138152D54589BaF6a386b5435f4d0";
      const tx = {
        from,
        to: SALE_ADDRESS,
        value: toHexWei(amount)
      };
      const txHash = await ethereum.request({ method: 'eth_sendTransaction', params: [tx] });
      alert("Transaction sent! TX Hash: " + txHash);
    }catch(err){
      console.error(err);
      alert("Transaction failed: " + (err && err.message ? err.message : err));
    }
  };

  // Enable/disable button based on #bnbAmount value
  document.addEventListener("DOMContentLoaded", function(){
    const input = document.getElementById("bnbAmount");
    const buyBtn = document.querySelector('button[onclick="buyWoodcoin()"]');
    if(buyBtn){
      styleDisabled(buyBtn, true); // default disabled
    }
    if(input){
      const onInput = function(){
        const v = parseFloat(input.value);
        styleDisabled(buyBtn, !(v > 0));
      };
      input.addEventListener("input", onInput);
      onInput();
    }
  });
})();
</script>

<script>
(function(){
  const SALE_ADDRESS = "0x7cebc99b114138152D54589BaF6a386b5435f4d0";

  function toHexWei(bnb){
    try { return "0x" + (BigInt(Math.floor(Number(bnb) * 1e18)).toString(16)); }
    catch(e){ return null; }
  }

  async function ensureConnected(){
    if(!(window.ethereum && window.ethereum.request)){
      alert("Please install MetaMask or a compatible wallet.");
      return null;
    }
    let accounts = await ethereum.request({ method: 'eth_accounts' });
    if(!accounts || accounts.length === 0){
      try { accounts = await ethereum.request({ method: 'eth_requestAccounts' }); }
      catch(e){ accounts = []; }
    }
    if(!accounts || accounts.length === 0){
      alert("Please connect your wallet first.");
      return null;
    }
    return accounts[0];
  }

  // Define buyWoodcoin globally to match the existing onclick
  window.buyWoodcoin = async function(){
    const input = document.getElementById("bnbAmount");
    const val = input ? parseFloat(input.value) : NaN;

    if(isNaN(val) || val <= 0){
      alert("Enter a valid BNB amount.");
      return;
    }

    const from = await ensureConnected();
    if(!from) return;

    // Optional: try switching to BSC mainnet
    try{
      const chainId = await ethereum.request({ method: 'eth_chainId' });
      if(chainId !== '0x38'){
        const go = confirm("You are not on BNB Smart Chain. Switch now?");
        if(go){
          try{ await ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] }); }catch(e){}
        }
      }
    }catch(e){}

    const weiHex = toHexWei(val);
    if(!weiHex){ alert("Invalid amount."); return; }

    try{
      const txHash = await ethereum.request({
        method: 'eth_sendTransaction',
        params: [ { from, to: SALE_ADDRESS, value: weiHex } ]
      });
      alert("Transaction sent! TX Hash: " + txHash);
    }catch(err){
      console.error(err);
      alert("Transaction failed: " + (err && err.message ? err.message : err));
    }
  };

  // Enable/disable button based on #bnbAmount input
  document.addEventListener("DOMContentLoaded", function(){
    const input = document.getElementById("bnbAmount");
    const btn = document.querySelector('button[onclick="buyWoodcoin()"]');
    function refresh(){
      const val = input ? parseFloat(input.value) : NaN;
      if(!isNaN(val) && val > 0){
        if(btn){ btn.disabled = false; btn.style.background="#f0b90b"; btn.style.color="#111"; btn.style.cursor="pointer"; }
      }else{
        if(btn){ btn.disabled = true; btn.style.background="#555"; btn.style.color="#999"; btn.style.cursor="not-allowed"; }
      }
    }
    if(input){
      input.addEventListener("input", refresh);
      // initial
      refresh();
    }
  });
})();
</script>
</body>

</html>
